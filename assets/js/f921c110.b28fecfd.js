"use strict";(globalThis.webpackChunksite=globalThis.webpackChunksite||[]).push([[776],{6027(e,n,a){a.r(n),a.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>g,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"module-1-ros2/labs/lab-4-actions-and-navigation","title":"Lab 4: Actions and Navigation","description":"Overview","source":"@site/docs/module-1-ros2/labs/lab-4-actions-and-navigation.md","sourceDirName":"module-1-ros2/labs","slug":"/module-1-ros2/labs/lab-4-actions-and-navigation","permalink":"/hackathon-physical-ai-and-humanoid-robotics-book/docs/module-1-ros2/labs/lab-4-actions-and-navigation","draft":false,"unlisted":false,"editUrl":"https://github.com/subhan-anwer/hackathon-physical-ai-and-humanoid-robotics-book/docs/module-1-ros2/labs/lab-4-actions-and-navigation.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Lab 4: Actions and Navigation","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Lab 3: Multi-Node Robot System","permalink":"/hackathon-physical-ai-and-humanoid-robotics-book/docs/module-1-ros2/labs/lab-3-multi-node-robot-system"},"next":{"title":"Chapter 1: What is a Digital Twin?","permalink":"/hackathon-physical-ai-and-humanoid-robotics-book/docs/module-2-digital-twin/chapter-1"}}');var i=a(4848),s=a(8453);const o={title:"Lab 4: Actions and Navigation",sidebar_position:4},l="Lab 4: Actions and Navigation",r={},c=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Creating Custom Action",id:"creating-custom-action",level:2},{value:"Updating package.xml for Actions",id:"updating-packagexml-for-actions",level:2},{value:"Navigation Action Server",id:"navigation-action-server",level:2},{value:"Navigation Action Client",id:"navigation-action-client",level:2},{value:"Updating setup.py for Actions",id:"updating-setuppy-for-actions",level:2},{value:"Building and Testing the Navigation System",id:"building-and-testing-the-navigation-system",level:2},{value:"Lab Exercise",id:"lab-exercise",level:2},{value:"Understanding Actions vs Services vs Topics",id:"understanding-actions-vs-services-vs-topics",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"lab-4-actions-and-navigation",children:"Lab 4: Actions and Navigation"})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"In this lab, you'll implement a navigation system using ROS 2 actions, which are perfect for long-running tasks that provide feedback. Actions are ideal for navigation, manipulation, and other tasks that take time to complete and need to report progress."}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"Before starting this lab, you should have:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Completed the previous labs"}),"\n",(0,i.jsx)(n.li,{children:"A working ROS 2 installation with your my_robot_package"}),"\n",(0,i.jsx)(n.li,{children:"Understanding of topics, services, and multi-node systems"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"creating-custom-action",children:"Creating Custom Action"}),"\n",(0,i.jsxs)(n.p,{children:["First, create an action definition in ",(0,i.jsx)(n.code,{children:"~/ros2_ws/src/my_robot_package/action/NavigateToPose.action"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# NavigateToPose.action\n# Goal: target pose\nfloat64 x\nfloat64 y\nfloat64 theta\n---\n# Result: success information\nbool success\nstring message\n---\n# Feedback: progress information\nfloat64 distance_to_goal\nstring status\n"})}),"\n",(0,i.jsx)(n.h2,{id:"updating-packagexml-for-actions",children:"Updating package.xml for Actions"}),"\n",(0,i.jsxs)(n.p,{children:["Add action generation to ",(0,i.jsx)(n.code,{children:"package.xml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>\n<package format="3">\n  <name>my_robot_package</name>\n  <version>0.0.0</version>\n  <description>Complete ROS 2 system with actions</description>\n  <maintainer email="your.email@example.com">Your Name</maintainer>\n  <license>Apache-2.0</license>\n\n  <depend>rclpy</depend>\n  <depend>std_msgs</depend>\n  <depend>geometry_msgs</depend>\n  <depend>sensor_msgs</depend>\n\n  <buildtool_depend>ament_python</buildtool_depend>\n  <buildtool_depend>rosidl_default_generators</buildtool_depend>\n\n  <exec_depend>rosidl_default_runtime</exec_depend>\n\n  <test_depend>ament_lint_auto</test_depend>\n  <test_depend>ament_lint_common</test_depend>\n\n  <member_of_group>rosidl_interface_packages</member_of_group>\n\n  <export>\n    <build_type>ament_python</build_type>\n  </export>\n</package>\n'})}),"\n",(0,i.jsx)(n.h2,{id:"navigation-action-server",children:"Navigation Action Server"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"my_robot_package/my_robot_package/navigation_server.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.action import ActionServer, CancelResponse, GoalResponse\nfrom rclpy.node import Node\nfrom my_robot_package.action import NavigateToPose\nfrom geometry_msgs.msg import Twist\nfrom sensor_msgs.msg import LaserScan\nimport math\nimport time\n\n\nclass NavigationServer(Node):\n\n    def __init__(self):\n        super().__init__('navigation_server')\n\n        self._action_server = ActionServer(\n            self,\n            NavigateToPose,\n            'navigate_to_pose',\n            execute_callback=self.execute_callback,\n            goal_callback=self.goal_callback,\n            cancel_callback=self.cancel_callback)\n\n        self.cmd_vel_publisher = self.create_publisher(Twist, 'cmd_vel', 10)\n        self.scan_subscriber = self.create_subscription(\n            LaserScan, 'scan', self.scan_callback, 10\n        )\n\n        self.current_position = [0.0, 0.0, 0.0]  # x, y, theta\n        self.laser_data = None\n        self.is_navigating = False\n\n    def scan_callback(self, msg):\n        self.laser_data = msg\n\n    def goal_callback(self, goal_request):\n        # Accept all goals\n        self.get_logger().info('Received navigation goal')\n        return GoalResponse.ACCEPT\n\n    def cancel_callback(self, goal_handle):\n        # Accept all cancel requests\n        self.get_logger().info('Received cancel request')\n        return CancelResponse.ACCEPT\n\n    def execute_callback(self, goal_handle):\n        self.get_logger().info('Executing navigation goal...')\n\n        # Get goal parameters\n        target_x = goal_handle.request.x\n        target_y = goal_handle.request.y\n        target_theta = goal_handle.request.theta\n\n        # Navigation parameters\n        linear_speed = 0.3\n        angular_speed = 0.3\n        tolerance = 0.1\n\n        self.is_navigating = True\n\n        feedback_msg = NavigateToPose.Feedback()\n        result = NavigateToPose.Result()\n\n        while self.is_navigating and not goal_handle.is_cancel_requested:\n            # Calculate distance to goal\n            dx = target_x - self.current_position[0]\n            dy = target_y - self.current_position[1]\n            distance_to_goal = math.sqrt(dx*dx + dy*dy)\n\n            # Update feedback\n            feedback_msg.distance_to_goal = distance_to_goal\n            feedback_msg.status = f'Navigating: {distance_to_goal:.2f}m to goal'\n            goal_handle.publish_feedback(feedback_msg)\n\n            # Check if we're close enough\n            if distance_to_goal < tolerance:\n                self.get_logger().info('Reached goal position!')\n                break\n\n            # Simple proportional controller\n            cmd_vel = Twist()\n\n            # Angular control (turn toward target)\n            target_angle = math.atan2(dy, dx)\n            angle_diff = target_angle - self.current_position[2]\n\n            # Normalize angle to [-pi, pi]\n            while angle_diff > math.pi:\n                angle_diff -= 2 * math.pi\n            while angle_diff < -math.pi:\n                angle_diff += 2 * math.pi\n\n            cmd_vel.angular.z = angular_speed * angle_diff\n            if abs(cmd_vel.angular.z) > angular_speed:\n                cmd_vel.angular.z = angular_speed if cmd_vel.angular.z > 0 else -angular_speed\n\n            # Linear control (move forward if roughly aligned)\n            if abs(angle_diff) < 0.2:  # If roughly facing the target\n                cmd_vel.linear.x = min(linear_speed, distance_to_goal * 0.5)\n\n            # Safety: stop if obstacle is detected\n            if self.laser_data and min(self.laser_data.ranges) < 0.5:\n                cmd_vel.linear.x = 0.0\n                cmd_vel.angular.z = 0.0\n                self.get_logger().warn('Obstacle detected, stopping navigation!')\n\n            # Publish command\n            self.cmd_vel_publisher.publish(cmd_vel)\n\n            # Update current position (simulation)\n            self.current_position[0] += cmd_vel.linear.x * 0.1 * math.cos(self.current_position[2])\n            self.current_position[1] += cmd_vel.linear.x * 0.1 * math.sin(self.current_position[2])\n            self.current_position[2] += cmd_vel.angular.z * 0.1\n\n            # Sleep briefly\n            time.sleep(0.1)\n\n        # Stop the robot\n        stop_msg = Twist()\n        self.cmd_vel_publisher.publish(stop_msg)\n\n        # Check if goal was canceled\n        if goal_handle.is_cancel_requested:\n            goal_handle.canceled()\n            result.success = False\n            result.message = 'Goal was canceled'\n            self.get_logger().info('Goal canceled')\n        else:\n            result.success = True\n            result.message = 'Successfully reached goal position'\n            self.get_logger().info('Goal succeeded')\n\n        self.is_navigating = False\n        return result\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    navigation_server = NavigationServer()\n    rclpy.spin(navigation_server)\n    navigation_server.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"navigation-action-client",children:"Navigation Action Client"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"my_robot_package/my_robot_package/navigation_client.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import sys\nimport rclpy\nfrom rclpy.action import ActionClient\nfrom rclpy.node import Node\nfrom my_robot_package.action import NavigateToPose\n\n\nclass NavigationClient(Node):\n\n    def __init__(self):\n        super().__init__('navigation_client')\n        self._action_client = ActionClient(\n            self,\n            NavigateToPose,\n            'navigate_to_pose')\n\n    def send_goal(self, x, y, theta):\n        goal_msg = NavigateToPose.Goal()\n        goal_msg.x = x\n        goal_msg.y = y\n        goal_msg.theta = theta\n\n        self.get_logger().info(f'Sending navigation goal: ({x}, {y}, {theta})')\n\n        # Wait for the action server to be available\n        self._action_client.wait_for_server()\n\n        # Send the goal\n        self._send_goal_future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback)\n\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\n\n    def goal_response_callback(self, future):\n        goal_handle = future.result()\n        if not goal_handle.accepted:\n            self.get_logger().info('Goal rejected :(')\n            return\n\n        self.get_logger().info('Goal accepted :)')\n\n        self._get_result_future = goal_handle.get_result_async()\n        self._get_result_future.add_done_callback(self.get_result_callback)\n\n    def feedback_callback(self, feedback_msg):\n        feedback = feedback_msg.feedback\n        self.get_logger().info(f'Feedback: {feedback.status}')\n\n    def get_result_callback(self, future):\n        result = future.result().result\n        self.get_logger().info(f'Result: {result.success}, {result.message}')\n        rclpy.shutdown()\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    if len(sys.argv) != 4:\n        print('Usage: ros2 run my_robot_package navigation_client <x> <y> <theta>')\n        return\n\n    x = float(sys.argv[1])\n    y = float(sys.argv[2])\n    theta = float(sys.argv[3])\n\n    action_client = NavigationClient()\n\n    action_client.send_goal(x, y, theta)\n\n    try:\n        rclpy.spin(action_client)\n    except KeyboardInterrupt:\n        pass\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"updating-setuppy-for-actions",children:"Updating setup.py for Actions"}),"\n",(0,i.jsxs)(n.p,{children:["Update ",(0,i.jsx)(n.code,{children:"setup.py"})," to include actions:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from setuptools import find_packages, setup\nfrom glob import glob\nimport os\n\npackage_name = 'my_robot_package'\n\nsetup(\n    name=package_name,\n    version='0.0.0',\n    packages=find_packages(exclude=['test']),\n    data_files=[\n        ('share/ament_index/resource_index/packages',\n            ['resource/' + package_name]),\n        ('share/' + package_name, ['package.xml']),\n        (os.path.join('share', package_name, 'msg'), glob('msg/*.msg')),\n        (os.path.join('share', package_name, 'srv'), glob('srv/*.srv')),\n        (os.path.join('share', package_name, 'action'), glob('action/*.action')),\n    ],\n    install_requires=['setuptools'],\n    zip_safe=True,\n    maintainer='Your Name',\n    maintainer_email='your.email@example.com',\n    description='Complete ROS 2 system with actions',\n    license='Apache-2.0',\n    tests_require=['pytest'],\n    entry_points={\n        'console_scripts': [\n            'talker = my_robot_package.publisher_member_function:main',\n            'listener = my_robot_package.subscriber_member_function:main',\n            'service_server = my_robot_package.service_server:main',\n            'service_client = my_robot_package.service_client:main',\n            'robot_controller = my_robot_package.robot_controller:main',\n            'sensor_simulator = my_robot_package.sensor_simulator:main',\n            'dashboard = my_robot_package.dashboard:main',\n            'navigation_server = my_robot_package.navigation_server:main',\n            'navigation_client = my_robot_package.navigation_client:main',\n        ],\n    },\n    package_data={\n        'my_robot_package': ['msg/*.msg', 'srv/*.srv', 'action/*.action']\n    },\n)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"building-and-testing-the-navigation-system",children:"Building and Testing the Navigation System"}),"\n",(0,i.jsx)(n.p,{children:"Build the complete package:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select my_robot_package --cmake-clean-cache\nsource install/setup.bash\n"})}),"\n",(0,i.jsx)(n.p,{children:"Run the navigation server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 run my_robot_package navigation_server\n"})}),"\n",(0,i.jsx)(n.p,{children:"In another terminal, send a navigation goal:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 run my_robot_package navigation_client 2.0 2.0 0.0\n"})}),"\n",(0,i.jsx)(n.h2,{id:"lab-exercise",children:"Lab Exercise"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Enhance the navigation system with a more sophisticated path planning algorithm"}),"\n",(0,i.jsx)(n.li,{children:"Add support for multiple simultaneous navigation goals"}),"\n",(0,i.jsx)(n.li,{children:"Implement obstacle avoidance with dynamic replanning"}),"\n",(0,i.jsx)(n.li,{children:"Create a simple GUI client for the navigation action"}),"\n",(0,i.jsx)(n.li,{children:"Add recovery behaviors when navigation fails"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"understanding-actions-vs-services-vs-topics",children:"Understanding Actions vs Services vs Topics"}),"\n",(0,i.jsx)(n.p,{children:"Actions provide several advantages over services for long-running tasks:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Feedback"}),": Continuous updates on progress"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cancelation"}),": Ability to cancel long-running tasks"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Preemption"}),": Ability to replace current goal with new one"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"State Management"}),": Built-in state machine for complex operations"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"In this lab, you've implemented a complete navigation system using ROS 2 actions. You've learned how actions differ from services and topics, and when to use each communication pattern. Actions are particularly useful for tasks that take time to complete and need to provide feedback, making them ideal for navigation, manipulation, and other robotics applications."})]})}function g(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,a){a.d(n,{R:()=>o,x:()=>l});var t=a(6540);const i={},s=t.createContext(i);function o(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);