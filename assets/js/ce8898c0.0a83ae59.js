"use strict";(globalThis.webpackChunksite=globalThis.webpackChunksite||[]).push([[477],{8003(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"module-1-ros2/labs/lab-2-custom-messages-and-services","title":"Lab 2: Custom Messages and Services","description":"Overview","source":"@site/docs/module-1-ros2/labs/lab-2-custom-messages-and-services.md","sourceDirName":"module-1-ros2/labs","slug":"/module-1-ros2/labs/lab-2-custom-messages-and-services","permalink":"/hackathon-physical-ai-and-humanoid-robotics-book/docs/module-1-ros2/labs/lab-2-custom-messages-and-services","draft":false,"unlisted":false,"editUrl":"https://github.com/subhan-anwer/hackathon-physical-ai-and-humanoid-robotics-book/docs/module-1-ros2/labs/lab-2-custom-messages-and-services.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Lab 2: Custom Messages and Services","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Lab 1: Installation and Basic Publisher/Subscriber","permalink":"/hackathon-physical-ai-and-humanoid-robotics-book/docs/module-1-ros2/labs/lab-1-installation-and-pubsub"},"next":{"title":"Lab 3: Multi-Node Robot System","permalink":"/hackathon-physical-ai-and-humanoid-robotics-book/docs/module-1-ros2/labs/lab-3-multi-node-robot-system"}}');var t=s(4848),o=s(8453);const a={title:"Lab 2: Custom Messages and Services",sidebar_position:2},i="Lab 2: Custom Messages and Services",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Creating Custom Messages",id:"creating-custom-messages",level:2},{value:"Updating package.xml",id:"updating-packagexml",level:2},{value:"Updating setup.py",id:"updating-setuppy",level:2},{value:"Service Server Implementation",id:"service-server-implementation",level:2},{value:"Service Client Implementation",id:"service-client-implementation",level:2},{value:"Updating setup.py for New Executables",id:"updating-setuppy-for-new-executables",level:2},{value:"Building and Testing",id:"building-and-testing",level:2},{value:"Lab Exercise",id:"lab-exercise",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"lab-2-custom-messages-and-services",children:"Lab 2: Custom Messages and Services"})}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"In this lab, you'll create custom message types and implement a service-based communication system. This builds upon the basic publisher-subscriber pattern by introducing request-response communication, which is essential for many robotics applications."}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(n.p,{children:"Before starting this lab, you should have:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Completed Lab 1: Installation and Basic Publisher/Subscriber"}),"\n",(0,t.jsx)(n.li,{children:"A working ROS 2 installation"}),"\n",(0,t.jsx)(n.li,{children:"Basic understanding of ROS 2 packages and nodes"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"creating-custom-messages",children:"Creating Custom Messages"}),"\n",(0,t.jsx)(n.p,{children:"First, create directories for your message definitions:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/ros2_ws/src/my_robot_package/msg\nmkdir -p ~/ros2_ws/src/my_robot_package/srv\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Create a custom message in ",(0,t.jsx)(n.code,{children:"~/ros2_ws/src/my_robot_package/msg/RobotStatus.msg"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# RobotStatus.msg\nstring robot_name\nint32 battery_level\nbool is_moving\nfloat64[] position  # [x, y, theta]\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Create a custom service in ",(0,t.jsx)(n.code,{children:"~/ros2_ws/src/my_robot_package/srv/MoveRobot.srv"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# MoveRobot.srv\nfloat64 x\nfloat64 y\nfloat64 theta\n---\nbool success\nstring message\n"})}),"\n",(0,t.jsx)(n.h2,{id:"updating-packagexml",children:"Updating package.xml"}),"\n",(0,t.jsxs)(n.p,{children:["Add the required dependencies to ",(0,t.jsx)(n.code,{children:"package.xml"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>\n<package format="3">\n  <name>my_robot_package</name>\n  <version>0.0.0</version>\n  <description>Custom messages and services example</description>\n  <maintainer email="your.email@example.com">Your Name</maintainer>\n  <license>Apache-2.0</license>\n\n  <depend>rclpy</depend>\n  <depend>std_msgs</depend>\n\n  <buildtool_depend>ament_python</buildtool_depend>\n  <buildtool_depend>rosidl_default_generators</buildtool_depend>\n\n  <exec_depend>rosidl_default_runtime</exec_depend>\n\n  <test_depend>ament_lint_auto</test_depend>\n  <test_depend>ament_lint_common</test_depend>\n\n  <member_of_group>rosidl_interface_packages</member_of_group>\n\n  <export>\n    <build_type>ament_python</build_type>\n  </export>\n</package>\n'})}),"\n",(0,t.jsx)(n.h2,{id:"updating-setuppy",children:"Updating setup.py"}),"\n",(0,t.jsxs)(n.p,{children:["Update ",(0,t.jsx)(n.code,{children:"setup.py"})," to include message generation:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"from setuptools import find_packages, setup\nfrom glob import glob\nimport os\n\npackage_name = 'my_robot_package'\n\nsetup(\n    name=package_name,\n    version='0.0.0',\n    packages=find_packages(exclude=['test']),\n    data_files=[\n        ('share/ament_index/resource_index/packages',\n            ['resource/' + package_name]),\n        ('share/' + package_name, ['package.xml']),\n        (os.path.join('share', package_name, 'msg'), glob('msg/*.msg')),\n        (os.path.join('share', package_name, 'srv'), glob('srv/*.srv')),\n    ],\n    install_requires=['setuptools'],\n    zip_safe=True,\n    maintainer='Your Name',\n    maintainer_email='your.email@example.com',\n    description='Custom messages and services example',\n    license='Apache-2.0',\n    tests_require=['pytest'],\n    entry_points={\n        'console_scripts': [\n            'talker = my_robot_package.publisher_member_function:main',\n            'listener = my_robot_package.subscriber_member_function:main',\n        ],\n    },\n    # Add the following for message generation\n    package_data={\n        'my_robot_package': ['msg/*.msg', 'srv/*.srv']\n    },\n)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"service-server-implementation",children:"Service Server Implementation"}),"\n",(0,t.jsxs)(n.p,{children:["Create a service server in ",(0,t.jsx)(n.code,{children:"my_robot_package/my_robot_package/service_server.py"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom my_robot_package.srv import MoveRobot\n\n\nclass MoveRobotService(Node):\n\n    def __init__(self):\n        super().__init__('move_robot_service')\n        self.srv = self.create_service(\n            MoveRobot,\n            'move_robot',\n            self.move_robot_callback\n        )\n\n    def move_robot_callback(self, request, response):\n        self.get_logger().info(\n            f'Received request to move robot to x: {request.x}, y: {request.y}, theta: {request.theta}'\n        )\n\n        # Simulate robot movement\n        # In a real robot, this would send commands to the robot's motion controller\n        success = True\n        message = f'Robot successfully moved to position ({request.x}, {request.y}, {request.theta})'\n\n        response.success = success\n        response.message = message\n\n        return response\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    move_robot_service = MoveRobotService()\n    rclpy.spin(move_robot_service)\n    move_robot_service.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,t.jsx)(n.h2,{id:"service-client-implementation",children:"Service Client Implementation"}),"\n",(0,t.jsxs)(n.p,{children:["Create a service client in ",(0,t.jsx)(n.code,{children:"my_robot_package/my_robot_package/service_client.py"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import sys\nimport rclpy\nfrom rclpy.node import Node\nfrom my_robot_package.srv import MoveRobot\n\n\nclass MoveRobotClient(Node):\n\n    def __init__(self):\n        super().__init__('move_robot_client')\n        self.cli = self.create_client(MoveRobot, 'move_robot')\n        while not self.cli.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Service not available, waiting again...')\n        self.req = MoveRobot.Request()\n\n    def send_request(self, x, y, theta):\n        self.req.x = x\n        self.req.y = y\n        self.req.theta = theta\n        self.future = self.cli.call_async(self.req)\n        rclpy.spin_until_future_complete(self, self.future)\n        return self.future.result()\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    if len(sys.argv) != 4:\n        print('Usage: ros2 run my_robot_package move_robot_client <x> <y> <theta>')\n        return\n\n    x = float(sys.argv[1])\n    y = float(sys.argv[2])\n    theta = float(sys.argv[3])\n\n    move_robot_client = MoveRobotClient()\n    response = move_robot_client.send_request(x, y, theta)\n\n    if response:\n        move_robot_client.get_logger().info(\n            f'Result: success={response.success}, message={response.message}'\n        )\n    else:\n        move_robot_client.get_logger().info('Service call failed')\n\n    move_robot_client.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,t.jsx)(n.h2,{id:"updating-setuppy-for-new-executables",children:"Updating setup.py for New Executables"}),"\n",(0,t.jsxs)(n.p,{children:["Add the new executables to ",(0,t.jsx)(n.code,{children:"setup.py"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"entry_points={\n    'console_scripts': [\n        'talker = my_robot_package.publisher_member_function:main',\n        'listener = my_robot_package.subscriber_member_function:main',\n        'service_server = my_robot_package.service_server:main',\n        'service_client = my_robot_package.service_client:main',\n    ],\n},\n"})}),"\n",(0,t.jsx)(n.h2,{id:"building-and-testing",children:"Building and Testing"}),"\n",(0,t.jsx)(n.p,{children:"Build the package:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select my_robot_package --cmake-clean-cache\nsource install/setup.bash\n"})}),"\n",(0,t.jsx)(n.p,{children:"Run the service server in one terminal:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ros2 run my_robot_package service_server\n"})}),"\n",(0,t.jsx)(n.p,{children:"In another terminal, call the service:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ros2 run my_robot_package service_client 1.0 2.0 1.57\n"})}),"\n",(0,t.jsx)(n.h2,{id:"lab-exercise",children:"Lab Exercise"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Create additional custom message types for different robot states (e.g., RobotTelemetry, SensorData)"}),"\n",(0,t.jsx)(n.li,{children:"Implement a service that returns robot status information"}),"\n",(0,t.jsx)(n.li,{children:"Create a client that calls multiple services in sequence"}),"\n",(0,t.jsx)(n.li,{children:"Add error handling to your service implementation"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsx)(n.p,{children:"In this lab, you've learned to create custom message and service types, implement service servers and clients, and understand the request-response communication pattern in ROS 2. This pattern is essential for operations that require acknowledgment or specific results, such as robot control commands or configuration requests."})]})}function m(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>a,x:()=>i});var r=s(6540);const t={},o=r.createContext(t);function a(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);