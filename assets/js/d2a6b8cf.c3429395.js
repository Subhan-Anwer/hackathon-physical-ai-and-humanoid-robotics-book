"use strict";(globalThis.webpackChunksite=globalThis.webpackChunksite||[]).push([[421],{7601(e,n,s){s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>m,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"module-1-ros2/labs/lab-3-multi-node-robot-system","title":"Lab 3: Multi-Node Robot System","description":"Overview","source":"@site/docs/module-1-ros2/labs/lab-3-multi-node-robot-system.md","sourceDirName":"module-1-ros2/labs","slug":"/module-1-ros2/labs/lab-3-multi-node-robot-system","permalink":"/hackathon-physical-ai-and-humanoid-robotics-book/docs/module-1-ros2/labs/lab-3-multi-node-robot-system","draft":false,"unlisted":false,"editUrl":"https://github.com/subhan-anwer/hackathon-physical-ai-and-humanoid-robotics-book/docs/module-1-ros2/labs/lab-3-multi-node-robot-system.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Lab 3: Multi-Node Robot System","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Lab 2: Custom Messages and Services","permalink":"/hackathon-physical-ai-and-humanoid-robotics-book/docs/module-1-ros2/labs/lab-2-custom-messages-and-services"},"next":{"title":"Lab 4: Actions and Navigation","permalink":"/hackathon-physical-ai-and-humanoid-robotics-book/docs/module-1-ros2/labs/lab-4-actions-and-navigation"}}');var a=s(4848),o=s(8453);const t={title:"Lab 3: Multi-Node Robot System",sidebar_position:3},l="Lab 3: Multi-Node Robot System",i={},c=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Robot Control Node",id:"robot-control-node",level:2},{value:"Sensor Simulator Node",id:"sensor-simulator-node",level:2},{value:"Dashboard Node",id:"dashboard-node",level:2},{value:"Launch File",id:"launch-file",level:2},{value:"Updating setup.py for New Nodes",id:"updating-setuppy-for-new-nodes",level:2},{value:"Building and Running the Multi-Node System",id:"building-and-running-the-multi-node-system",level:2},{value:"Lab Exercise",id:"lab-exercise",level:2},{value:"Understanding the System Architecture",id:"understanding-the-system-architecture",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"lab-3-multi-node-robot-system",children:"Lab 3: Multi-Node Robot System"})}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.p,{children:"In this lab, you'll create a more complex system with multiple nodes that work together to simulate a robot with sensors and control systems. This lab demonstrates how to build complete robotic applications using multiple interconnected nodes."}),"\n",(0,a.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsx)(n.p,{children:"Before starting this lab, you should have:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Completed Lab 1 and Lab 2"}),"\n",(0,a.jsx)(n.li,{children:"A working ROS 2 installation with your my_robot_package"}),"\n",(0,a.jsx)(n.li,{children:"Understanding of topics, services, and custom message types"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"robot-control-node",children:"Robot Control Node"}),"\n",(0,a.jsxs)(n.p,{children:["Create ",(0,a.jsx)(n.code,{children:"my_robot_package/my_robot_package/robot_controller.py"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import Twist\nfrom sensor_msgs.msg import LaserScan\nfrom std_msgs.msg import Float32\nimport math\n\n\nclass RobotController(Node):\n\n    def __init__(self):\n        super().__init__('robot_controller')\n\n        # Publishers\n        self.cmd_vel_publisher = self.create_publisher(Twist, 'cmd_vel', 10)\n        self.battery_publisher = self.create_publisher(Float32, 'battery_level', 10)\n\n        # Subscribers\n        self.scan_subscriber = self.create_subscription(\n            LaserScan, 'scan', self.scan_callback, 10\n        )\n\n        # Timer for control loop\n        self.timer = self.create_timer(0.1, self.control_loop)\n\n        # Robot state\n        self.laser_data = None\n        self.battery_level = 100.0\n        self.obstacle_distance = float('inf')\n\n        # Initialize battery level\n        self.publish_battery()\n\n    def scan_callback(self, msg):\n        # Process laser scan to find closest obstacle\n        if len(msg.ranges) > 0:\n            valid_ranges = [r for r in msg.ranges if r > 0 and not math.isinf(r)]\n            if valid_ranges:\n                self.obstacle_distance = min(valid_ranges)\n            else:\n                self.obstacle_distance = float('inf')\n\n    def control_loop(self):\n        # Simple obstacle avoidance behavior\n        msg = Twist()\n\n        if self.obstacle_distance < 1.0:  # Obstacle within 1 meter\n            # Stop and turn\n            msg.linear.x = 0.0\n            msg.angular.z = 0.5  # Turn right\n        else:\n            # Move forward\n            msg.linear.x = 0.5\n            msg.angular.z = 0.0\n\n        # Simulate battery drain\n        self.battery_level -= 0.01\n        if self.battery_level < 0:\n            self.battery_level = 0\n\n        self.cmd_vel_publisher.publish(msg)\n        self.publish_battery()\n\n    def publish_battery(self):\n        battery_msg = Float32()\n        battery_msg.data = self.battery_level\n        self.battery_publisher.publish(battery_msg)\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    robot_controller = RobotController()\n    rclpy.spin(robot_controller)\n    robot_controller.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,a.jsx)(n.h2,{id:"sensor-simulator-node",children:"Sensor Simulator Node"}),"\n",(0,a.jsxs)(n.p,{children:["Create ",(0,a.jsx)(n.code,{children:"my_robot_package/my_robot_package/sensor_simulator.py"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import LaserScan\nimport math\nimport random\n\n\nclass SensorSimulator(Node):\n\n    def __init__(self):\n        super().__init__('sensor_simulator')\n\n        self.publisher = self.create_publisher(LaserScan, 'scan', 10)\n        self.timer = self.create_timer(0.1, self.publish_scan)\n\n        # Laser scan parameters\n        self.angle_min = -math.pi / 2\n        self.angle_max = math.pi / 2\n        self.angle_increment = math.pi / 180  # 1 degree increments\n        self.scan_time = 0.1\n        self.range_min = 0.1\n        self.range_max = 10.0\n\n    def publish_scan(self):\n        msg = LaserScan()\n\n        msg.header.stamp = self.get_clock().now().to_msg()\n        msg.header.frame_id = 'laser_frame'\n\n        msg.angle_min = self.angle_min\n        msg.angle_max = self.angle_max\n        msg.angle_increment = self.angle_increment\n        msg.time_increment = 0.0\n        msg.scan_time = self.scan_time\n        msg.range_min = self.range_min\n        msg.range_max = self.range_max\n\n        # Generate simulated laser ranges\n        num_ranges = int((self.angle_max - self.angle_min) / self.angle_increment) + 1\n        ranges = []\n\n        for i in range(num_ranges):\n            angle = self.angle_min + i * self.angle_increment\n\n            # Simulate some obstacles\n            distance = self.range_max\n\n            # Place an obstacle in front of the robot\n            if -0.5 < angle < 0.5:\n                distance = 1.5 + random.uniform(-0.2, 0.2)\n\n            # Add some random noise\n            distance += random.uniform(-0.05, 0.05)\n\n            ranges.append(max(self.range_min, min(distance, self.range_max)))\n\n        msg.ranges = ranges\n        msg.intensities = []  # No intensity data\n\n        self.publisher.publish(msg)\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    sensor_simulator = SensorSimulator()\n    rclpy.spin(sensor_simulator)\n    sensor_simulator.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,a.jsx)(n.h2,{id:"dashboard-node",children:"Dashboard Node"}),"\n",(0,a.jsxs)(n.p,{children:["Create ",(0,a.jsx)(n.code,{children:"my_robot_package/my_robot_package/dashboard.py"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import Twist\nfrom sensor_msgs.msg import LaserScan\nfrom std_msgs.msg import Float32\n\n\nclass Dashboard(Node):\n\n    def __init__(self):\n        super().__init__('dashboard')\n\n        self.subscription_cmd_vel = self.create_subscription(\n            Twist, 'cmd_vel', self.cmd_vel_callback, 10\n        )\n        self.subscription_scan = self.create_subscription(\n            LaserScan, 'scan', self.scan_callback, 10\n        )\n        self.subscription_battery = self.create_subscription(\n            Float32, 'battery_level', self.battery_callback, 10\n        )\n\n        self.linear_velocity = 0.0\n        self.angular_velocity = 0.0\n        self.battery_level = 100.0\n        self.closest_obstacle = float('inf')\n\n    def cmd_vel_callback(self, msg):\n        self.linear_velocity = msg.linear.x\n        self.angular_velocity = msg.angular.z\n        self.get_logger().info(\n            f'Velocity: linear={self.linear_velocity:.2f}, angular={self.angular_velocity:.2f}'\n        )\n\n    def scan_callback(self, msg):\n        if len(msg.ranges) > 0:\n            valid_ranges = [r for r in msg.ranges if r > 0 and not float('inf')]\n            if valid_ranges:\n                self.closest_obstacle = min(valid_ranges)\n            else:\n                self.closest_obstacle = float('inf')\n\n    def battery_callback(self, msg):\n        self.battery_level = msg.data\n        if self.battery_level < 20:\n            self.get_logger().warn(f'Low battery: {self.battery_level:.1f}%')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    dashboard = Dashboard()\n\n    try:\n        rclpy.spin(dashboard)\n    except KeyboardInterrupt:\n        pass\n\n    dashboard.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,a.jsx)(n.h2,{id:"launch-file",children:"Launch File"}),"\n",(0,a.jsx)(n.p,{children:"Create a launch file to run all nodes together. First, create a launch directory:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/ros2_ws/src/my_robot_package/launch\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Create ",(0,a.jsx)(n.code,{children:"~/ros2_ws/src/my_robot_package/launch/multi_robot_system.py"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"from launch import LaunchDescription\nfrom launch_ros.actions import Node\n\n\ndef generate_launch_description():\n    return LaunchDescription([\n        Node(\n            package='my_robot_package',\n            executable='sensor_simulator',\n            name='sensor_simulator',\n            output='screen'\n        ),\n        Node(\n            package='my_robot_package',\n            executable='robot_controller',\n            name='robot_controller',\n            output='screen'\n        ),\n        Node(\n            package='my_robot_package',\n            executable='dashboard',\n            name='dashboard',\n            output='screen'\n        )\n    ])\n"})}),"\n",(0,a.jsx)(n.h2,{id:"updating-setuppy-for-new-nodes",children:"Updating setup.py for New Nodes"}),"\n",(0,a.jsxs)(n.p,{children:["Add the new executables to ",(0,a.jsx)(n.code,{children:"setup.py"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"entry_points={\n    'console_scripts': [\n        'talker = my_robot_package.publisher_member_function:main',\n        'listener = my_robot_package.subscriber_member_function:main',\n        'service_server = my_robot_package.service_server:main',\n        'service_client = my_robot_package.service_client:main',\n        'robot_controller = my_robot_package.robot_controller:main',\n        'sensor_simulator = my_robot_package.sensor_simulator:main',\n        'dashboard = my_robot_package.dashboard:main',\n    ],\n},\n"})}),"\n",(0,a.jsx)(n.h2,{id:"building-and-running-the-multi-node-system",children:"Building and Running the Multi-Node System"}),"\n",(0,a.jsx)(n.p,{children:"Build the package:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"cd ~/ros2_ws\ncolcon build --packages-select my_robot_package\nsource install/setup.bash\n"})}),"\n",(0,a.jsx)(n.p,{children:"Run all nodes together using the launch file:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"ros2 launch my_robot_package multi_robot_system.py\n"})}),"\n",(0,a.jsx)(n.h2,{id:"lab-exercise",children:"Lab Exercise"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Add more sensor types to the system (e.g., IMU, camera)"}),"\n",(0,a.jsx)(n.li,{children:"Implement a more sophisticated control algorithm (e.g., PID controller)"}),"\n",(0,a.jsx)(n.li,{children:"Add a navigation node that plans paths to specific goals"}),"\n",(0,a.jsx)(n.li,{children:"Create a parameter server to configure robot behavior at runtime"}),"\n",(0,a.jsx)(n.li,{children:"Add logging and visualization of robot state"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"understanding-the-system-architecture",children:"Understanding the System Architecture"}),"\n",(0,a.jsx)(n.p,{children:"This multi-node system demonstrates several important ROS 2 concepts:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Modularity"}),": Each node has a specific responsibility"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Decoupling"}),": Nodes communicate through topics rather than direct function calls"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Scalability"}),": New nodes can be added without modifying existing ones"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Robustness"}),": If one node fails, others can continue operating"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"The system architecture includes:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Sensor Simulator"}),": Provides simulated sensor data"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Robot Controller"}),": Processes sensor data and generates control commands"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Dashboard"}),": Monitors system state and provides feedback"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsx)(n.p,{children:"In this lab, you've built a complete multi-node robotic system that demonstrates how different components work together. You've learned to design modular systems, use launch files to coordinate multiple nodes, and implement a complete robot control architecture with sensors, control, and monitoring."})]})}function m(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>l});var r=s(6540);const a={},o=r.createContext(a);function t(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);